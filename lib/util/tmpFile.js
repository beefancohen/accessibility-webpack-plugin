'use strict';

var fs = require('fs');
var tmp = require('tmp');

module.exports = function writeModule(directory) {
  var contents = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

  return new Promise(function (resolve, reject) {
    tmp.file({ postfix: '.js', dir: directory }, function (tmpErr, path, fd, cleanupCallback) {
      if (tmpErr) {
        reject(tmpErr);
      }

      fs.writeFile(path, contents, function (err) {
        if (err) {
          cleanupCallback();
          reject(err);
        }

        try {
          resolve(path);
        } catch (e) {
          throw e;
          // Just skip file if it fails.
        }
      });
    });
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL3RtcEZpbGUuanMiXSwibmFtZXMiOlsiZnMiLCJyZXF1aXJlIiwidG1wIiwibW9kdWxlIiwiZXhwb3J0cyIsIndyaXRlTW9kdWxlIiwiZGlyZWN0b3J5IiwiY29udGVudHMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZpbGUiLCJwb3N0Zml4IiwiZGlyIiwidG1wRXJyIiwicGF0aCIsImZkIiwiY2xlYW51cENhbGxiYWNrIiwid3JpdGVGaWxlIiwiZXJyIiwiZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxLQUFLQyxRQUFRLElBQVIsQ0FBWDtBQUNBLElBQU1DLE1BQU1ELFFBQVEsS0FBUixDQUFaOztBQUVBRSxPQUFPQyxPQUFQLEdBQWlCLFNBQVNDLFdBQVQsQ0FBcUJDLFNBQXJCLEVBQStDO0FBQUEsTUFBZkMsUUFBZSx1RUFBSixFQUFJOztBQUM5RCxTQUFPLElBQUlDLE9BQUosQ0FBWSxVQUFDQyxPQUFELEVBQVVDLE1BQVYsRUFBcUI7QUFDdENSLFFBQUlTLElBQUosQ0FBUyxFQUFFQyxTQUFTLEtBQVgsRUFBa0JDLEtBQUtQLFNBQXZCLEVBQVQsRUFBNkMsVUFBQ1EsTUFBRCxFQUFTQyxJQUFULEVBQWVDLEVBQWYsRUFBbUJDLGVBQW5CLEVBQXVDO0FBQ2xGLFVBQUlILE1BQUosRUFBWTtBQUNWSixlQUFPSSxNQUFQO0FBQ0Q7O0FBRURkLFNBQUdrQixTQUFILENBQWFILElBQWIsRUFBbUJSLFFBQW5CLEVBQTZCLFVBQUNZLEdBQUQsRUFBUztBQUNwQyxZQUFJQSxHQUFKLEVBQVM7QUFDUEY7QUFDQVAsaUJBQU9TLEdBQVA7QUFDRDs7QUFFRCxZQUFJO0FBQ0ZWLGtCQUFRTSxJQUFSO0FBQ0QsU0FGRCxDQUVFLE9BQU9LLENBQVAsRUFBVTtBQUNWLGdCQUFNQSxDQUFOO0FBQ0E7QUFDRDtBQUNGLE9BWkQ7QUFhRCxLQWxCRDtBQW1CRCxHQXBCTSxDQUFQO0FBcUJELENBdEJEIiwiZmlsZSI6InRtcEZpbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5jb25zdCB0bXAgPSByZXF1aXJlKCd0bXAnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiB3cml0ZU1vZHVsZShkaXJlY3RvcnksIGNvbnRlbnRzID0gJycpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB0bXAuZmlsZSh7IHBvc3RmaXg6ICcuanMnLCBkaXI6IGRpcmVjdG9yeSB9LCAodG1wRXJyLCBwYXRoLCBmZCwgY2xlYW51cENhbGxiYWNrKSA9PiB7XG4gICAgICBpZiAodG1wRXJyKSB7XG4gICAgICAgIHJlamVjdCh0bXBFcnIpO1xuICAgICAgfVxuXG4gICAgICBmcy53cml0ZUZpbGUocGF0aCwgY29udGVudHMsIChlcnIpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNsZWFudXBDYWxsYmFjaygpO1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXNvbHZlKHBhdGgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAvLyBKdXN0IHNraXAgZmlsZSBpZiBpdCBmYWlscy5cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufTtcbiJdfQ==